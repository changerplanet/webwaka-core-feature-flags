
üîì PHASE 3F-3 ‚Äî CORE FEATURE FLAGS & EXPERIMENTS

IMPLEMENTATION PROMPT (AUTHORITATIVE)

‚∏ª

CONTEXT (READ CAREFULLY)

You are executing Phase 3F-3 of the WebWaka Modular Rebuild.

This phase is IMPLEMENTATION, not research, not specification, not UI.

You are implementing the Core Feature Flags & Experiments engine as a pure, headless, deterministic core library.

‚∏ª

üîê NON-NEGOTIABLE BINDINGS (MUST BE STATED AND FOLLOWED)

‚úÖ Repository (IMMUTABLE)

You MUST work only in the following repository:

changerplanet/webwaka-core-feature-flags

	‚Ä¢	Branch: main
	‚Ä¢	Visibility: public
	‚Ä¢	Governance files already exist
	‚Ä¢	Vercel is already configured (do not modify infra)

üö´ If this repository does not exist or cannot be cloned cleanly, STOP IMMEDIATELY and report.

‚∏ª

‚úÖ Coding / Execution Platform (IMMUTABLE)

You MUST implement this phase using:

Replit

	‚Ä¢	First action: clone the repo exactly as-is
	‚Ä¢	If the repo is empty:
	‚Ä¢	Clone it without adding anything
	‚Ä¢	If Replit auto-adds placeholders, DELETE them before starting
	‚Ä¢	Do NOT scaffold frameworks
	‚Ä¢	Do NOT add runtime servers
	‚Ä¢	Do NOT add UI code

‚∏ª

üö´ SCOPE BOUNDARIES (STRICT)

You must NOT implement:
	‚Ä¢	‚ùå UI components
	‚Ä¢	‚ùå Dashboards
	‚Ä¢	‚ùå Databases or persistence
	‚Ä¢	‚ùå Network calls
	‚Ä¢	‚ùå Background jobs
	‚Ä¢	‚ùå Feature rollout UIs
	‚Ä¢	‚ùå Admin tools
	‚Ä¢	‚ùå SDKs or CLIs

This is a pure evaluation engine only.

‚∏ª

üéØ OBJECTIVE

Implement a deterministic Feature Flag & Experiment evaluation engine that can be used by:
	‚Ä¢	Super Admin dashboards
	‚Ä¢	Partner dashboards
	‚Ä¢	Tenant dashboards
	‚Ä¢	Any Suite (POS, SVM, MVM, etc.)
	‚Ä¢	Offline contexts (via snapshots)

‚∏ª

üì¶ REQUIRED OUTPUT (WHAT TO BUILD)

1Ô∏è‚É£ Domain Models (Zod-validated, immutable)

You MUST define:
	‚Ä¢	FeatureDefinition
	‚Ä¢	FeatureRule
	‚Ä¢	ExperimentDefinition
	‚Ä¢	ExperimentVariant
	‚Ä¢	EvaluationContext
	‚Ä¢	FeatureEvaluationResult
	‚Ä¢	ExperimentAssignment
	‚Ä¢	FeatureSnapshot

All models must be:
	‚Ä¢	JSON-serializable
	‚Ä¢	Deeply immutable (freeze outputs)
	‚Ä¢	Deterministic

‚∏ª

2Ô∏è‚É£ Precedence Hierarchy (LOCKED)

You MUST enforce the following precedence order exactly:
	1.	Individual overrides
	2.	Group overrides
	3.	Tenant rules
	4.	Partner rules
	5.	Plan rules
	6.	System defaults

Higher levels always override lower ones.

‚∏ª

3Ô∏è‚É£ Core APIs (MANDATORY)

Implement exactly the following APIs:

checkFeature(
  featureId,
  context,
  rules
): FeatureEvaluationResult

assignExperimentVariant(
  experiment,
  context
): ExperimentAssignment

generateFeatureSnapshot(
  context,
  features,
  experiments,
  options?
): FeatureSnapshot

verifySnapshot(snapshot): boolean

evaluateFromSnapshot(
  featureId,
  snapshot,
  evaluationTime,
  expectedTenantId?
): FeatureEvaluationResult


‚∏ª

4Ô∏è‚É£ Determinism & Integrity (CRITICAL)

You MUST prove:
	‚Ä¢	Same input ‚Üí same output (10√ó repeated tests)
	‚Ä¢	No use of Date.now(), Math.random(), or system entropy
	‚Ä¢	Experiment bucketing uses SHA-256 hashing
	‚Ä¢	Snapshot integrity via checksum verification
	‚Ä¢	Tampering is detectable

‚∏ª

5Ô∏è‚É£ Tenant Isolation (MANDATORY)
	‚Ä¢	Every evaluation MUST be tenant-scoped
	‚Ä¢	Cross-tenant access MUST throw an explicit error
	‚Ä¢	Snapshot evaluation MUST require expectedTenantId

‚∏ª

6Ô∏è‚É£ Tests (HARD REQUIREMENTS)

You MUST include tests that prove:
	‚Ä¢	Precedence correctness
	‚Ä¢	Determinism (10√ó repeat)
	‚Ä¢	Experiment bucketing stability
	‚Ä¢	Snapshot generation & verification
	‚Ä¢	Offline vs online parity
	‚Ä¢	Tenant isolation enforcement
	‚Ä¢	JSON round-trip serialization

üìä Minimum coverage: ‚â• 80%

‚∏ª

7Ô∏è‚É£ Module Registration

Update module.manifest.json to register capabilities such as:

[
  "feature:check",
  "experiment:assign",
  "feature:snapshot.generate",
  "feature:snapshot.verify",
  "experiment:snapshot.evaluate"
]


‚∏ª

üß± ARCHITECTURAL INVARIANTS (MUST HOLD)
	‚Ä¢	Pure functions only
	‚Ä¢	No side effects
	‚Ä¢	No hidden state
	‚Ä¢	No time dependence
	‚Ä¢	No coupling to pricing, incentives, payments, or subscriptions

‚∏ª

‚õî HARD STOP

After completing implementation:

‚õî STOP
‚õî Do NOT proceed to Phase 4
‚õî Do NOT add enhancements
‚õî Await explicit authorization

‚∏ª

‚úÖ ACKNOWLEDGEMENT FORMAT (REQUIRED)

Reply only with:

‚ÄúPhase 3F-3 acknowledged. Proceeding on Replit using repository changerplanet/webwaka-core-feature-flags exactly as instructed.‚Äù

Then execute.